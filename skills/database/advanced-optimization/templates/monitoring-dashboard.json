{
  "dashboard": {
    "annotations": {
      "list": [
        {
          "datasource": "Prometheus",
          "enable": true,
          "expr": "ALERTS{alertstate='firing'}",
          "name": "Alerts",
          "step": "60s",
          "tagKeys": "alertname,severity",
          "textFormat": "{{alertname}}",
          "titleFormat": "Alert"
        }
      ]
    },
    "description": "Comprehensive database monitoring dashboard for PostgreSQL, MongoDB, and Redis",
    "panels": [
      {
        "collapsed": false,
        "id": 1,
        "title": "PostgreSQL Metrics",
        "type": "row"
      },
      {
        "datasource": "Prometheus",
        "id": 2,
        "targets": [
          {
            "expr": "rate(pg_stat_statements_total_time_seconds[5m])",
            "legendFormat": "Total Query Time",
            "refId": "A"
          },
          {
            "expr": "rate(pg_stat_statements_calls_total[5m])",
            "legendFormat": "Query Rate",
            "refId": "B"
          }
        ],
        "title": "PostgreSQL - Query Performance",
        "type": "graph",
        "yaxes": [
          {
            "format": "s",
            "label": "Time"
          },
          {
            "format": "short",
            "label": "Queries/sec"
          }
        ]
      },
      {
        "colors": [
          "#d44a3a",
          "#e0b400",
          "#299c46"
        ],
        "datasource": "Prometheus",
        "format": "percent",
        "gauge": {
          "maxValue": 100,
          "minValue": 0,
          "show": true,
          "thresholdMarkers": true
        },
        "id": 3,
        "targets": [
          {
            "expr": "pg_stat_database_blks_hit / (pg_stat_database_blks_hit + pg_stat_database_blks_read) * 100",
            "refId": "A"
          }
        ],
        "thresholds": "80,90",
        "title": "PostgreSQL - Cache Hit Ratio",
        "type": "singlestat"
      },
      {
        "datasource": "Prometheus",
        "id": 4,
        "targets": [
          {
            "expr": "pg_stat_activity_count",
            "legendFormat": "Active Connections",
            "refId": "A"
          },
          {
            "expr": "pg_settings_max_connections",
            "legendFormat": "Max Connections",
            "refId": "B"
          }
        ],
        "title": "PostgreSQL - Connections",
        "type": "graph",
        "yaxes": [
          {
            "format": "short",
            "label": "Connections"
          }
        ]
      },
      {
        "datasource": "Prometheus",
        "id": 5,
        "targets": [
          {
            "expr": "rate(pg_stat_database_xact_commit[5m])",
            "legendFormat": "Commits/sec",
            "refId": "A"
          },
          {
            "expr": "rate(pg_stat_database_xact_rollback[5m])",
            "legendFormat": "Rollbacks/sec",
            "refId": "B"
          }
        ],
        "title": "PostgreSQL - Transaction Rate",
        "type": "graph",
        "yaxes": [
          {
            "format": "short",
            "label": "Transactions/sec"
          }
        ]
      },
      {
        "datasource": "PostgreSQL",
        "id": 6,
        "targets": [
          {
            "rawSql": "SELECT substring(query, 1, 100) AS query, calls, ROUND(mean_exec_time::numeric, 2) AS avg_ms FROM pg_stat_statements ORDER BY mean_exec_time DESC LIMIT 10",
            "refId": "A"
          }
        ],
        "title": "PostgreSQL - Top 10 Slowest Queries",
        "type": "table"
      },
      {
        "datasource": "Prometheus",
        "id": 7,
        "targets": [
          {
            "expr": "pg_stat_user_tables_n_dead_tup",
            "legendFormat": "{{schemaname}}.{{relname}}",
            "refId": "A"
          }
        ],
        "title": "PostgreSQL - Dead Tuples",
        "type": "graph",
        "yaxes": [
          {
            "format": "short",
            "label": "Dead Tuples"
          }
        ]
      },
      {
        "collapsed": false,
        "id": 8,
        "title": "MongoDB Metrics",
        "type": "row"
      },
      {
        "datasource": "Prometheus",
        "id": 9,
        "targets": [
          {
            "expr": "rate(mongodb_op_counters_total{type='query'}[5m])",
            "legendFormat": "Queries/sec",
            "refId": "A"
          },
          {
            "expr": "rate(mongodb_op_counters_total{type='insert'}[5m])",
            "legendFormat": "Inserts/sec",
            "refId": "B"
          },
          {
            "expr": "rate(mongodb_op_counters_total{type='update'}[5m])",
            "legendFormat": "Updates/sec",
            "refId": "C"
          },
          {
            "expr": "rate(mongodb_op_counters_total{type='delete'}[5m])",
            "legendFormat": "Deletes/sec",
            "refId": "D"
          }
        ],
        "title": "MongoDB - Operations Per Second",
        "type": "graph",
        "yaxes": [
          {
            "format": "short",
            "label": "Operations/sec"
          }
        ]
      },
      {
        "colors": [
          "#299c46",
          "#e0b400",
          "#d44a3a"
        ],
        "datasource": "Prometheus",
        "format": "short",
        "id": 10,
        "targets": [
          {
            "expr": "mongodb_connections{state='current'}",
            "refId": "A"
          }
        ],
        "thresholds": "800,900",
        "title": "MongoDB - Connections",
        "type": "singlestat"
      },
      {
        "datasource": "Prometheus",
        "id": 11,
        "targets": [
          {
            "expr": "mongodb_memory{type='resident'}",
            "legendFormat": "Resident Memory",
            "refId": "A"
          },
          {
            "expr": "mongodb_memory{type='virtual'}",
            "legendFormat": "Virtual Memory",
            "refId": "B"
          }
        ],
        "title": "MongoDB - Memory Usage",
        "type": "graph",
        "yaxes": [
          {
            "format": "bytes",
            "label": "Memory"
          }
        ]
      },
      {
        "alert": {
          "conditions": [
            {
              "evaluator": {
                "params": [
                  10
                ],
                "type": "gt"
              },
              "operator": {
                "type": "and"
              },
              "query": {
                "params": [
                  "A",
                  "5m",
                  "now"
                ]
              },
              "reducer": {
                "params": [],
                "type": "avg"
              },
              "type": "query"
            }
          ],
          "name": "High Replication Lag"
        },
        "datasource": "Prometheus",
        "id": 12,
        "targets": [
          {
            "expr": "mongodb_mongod_replset_member_replication_lag",
            "legendFormat": "{{member}}",
            "refId": "A"
          }
        ],
        "title": "MongoDB - Replication Lag",
        "type": "graph",
        "yaxes": [
          {
            "format": "s",
            "label": "Lag"
          }
        ]
      },
      {
        "datasource": "Prometheus",
        "id": 13,
        "targets": [
          {
            "expr": "rate(mongodb_mongod_metrics_document_total[5m])",
            "legendFormat": "{{state}}",
            "refId": "A"
          }
        ],
        "title": "MongoDB - Document Operations",
        "type": "graph",
        "yaxes": [
          {
            "format": "short",
            "label": "Operations/sec"
          }
        ]
      },
      {
        "collapsed": false,
        "id": 14,
        "title": "Redis Metrics",
        "type": "row"
      },
      {
        "colors": [
          "#d44a3a",
          "#e0b400",
          "#299c46"
        ],
        "datasource": "Prometheus",
        "format": "percent",
        "gauge": {
          "maxValue": 100,
          "minValue": 0,
          "show": true,
          "thresholdMarkers": true
        },
        "id": 15,
        "targets": [
          {
            "expr": "redis_keyspace_hits_total / (redis_keyspace_hits_total + redis_keyspace_misses_total) * 100",
            "refId": "A"
          }
        ],
        "thresholds": "70,90",
        "title": "Redis - Cache Hit Rate",
        "type": "singlestat"
      },
      {
        "datasource": "Prometheus",
        "id": 16,
        "targets": [
          {
            "expr": "redis_memory_used_bytes",
            "legendFormat": "Used Memory",
            "refId": "A"
          },
          {
            "expr": "redis_memory_max_bytes",
            "legendFormat": "Max Memory",
            "refId": "B"
          }
        ],
        "title": "Redis - Memory Usage",
        "type": "graph",
        "yaxes": [
          {
            "format": "bytes",
            "label": "Memory"
          }
        ]
      },
      {
        "datasource": "Prometheus",
        "id": 17,
        "targets": [
          {
            "expr": "rate(redis_commands_processed_total[5m])",
            "legendFormat": "Commands/sec",
            "refId": "A"
          }
        ],
        "title": "Redis - Commands Per Second",
        "type": "graph",
        "yaxes": [
          {
            "format": "short",
            "label": "Commands/sec"
          }
        ]
      },
      {
        "colors": [
          "#299c46",
          "#e0b400",
          "#d44a3a"
        ],
        "datasource": "Prometheus",
        "format": "short",
        "id": 18,
        "targets": [
          {
            "expr": "redis_connected_clients",
            "refId": "A"
          }
        ],
        "thresholds": "900,950",
        "title": "Redis - Connected Clients",
        "type": "singlestat"
      },
      {
        "alert": {
          "conditions": [
            {
              "evaluator": {
                "params": [
                  100
                ],
                "type": "gt"
              },
              "operator": {
                "type": "and"
              },
              "query": {
                "params": [
                  "A",
                  "5m",
                  "now"
                ]
              },
              "reducer": {
                "params": [],
                "type": "avg"
              },
              "type": "query"
            }
          ],
          "name": "High Eviction Rate"
        },
        "datasource": "Prometheus",
        "id": 19,
        "targets": [
          {
            "expr": "rate(redis_evicted_keys_total[5m])",
            "legendFormat": "Evictions/sec",
            "refId": "A"
          }
        ],
        "title": "Redis - Evicted Keys",
        "type": "graph",
        "yaxes": [
          {
            "format": "short",
            "label": "Keys/sec"
          }
        ]
      },
      {
        "datasource": "Prometheus",
        "id": 20,
        "targets": [
          {
            "expr": "redis_db_keys",
            "legendFormat": "db{{db}}",
            "refId": "A"
          }
        ],
        "title": "Redis - Keyspace",
        "type": "graph",
        "yaxes": [
          {
            "format": "short",
            "label": "Keys"
          }
        ]
      },
      {
        "collapsed": false,
        "id": 21,
        "title": "System Metrics",
        "type": "row"
      },
      {
        "datasource": "Prometheus",
        "id": 22,
        "targets": [
          {
            "expr": "100 - (avg by (instance) (rate(node_cpu_seconds_total{mode='idle'}[5m])) * 100)",
            "legendFormat": "{{instance}}",
            "refId": "A"
          }
        ],
        "title": "CPU Usage",
        "type": "graph",
        "yaxes": [
          {
            "format": "percent",
            "label": "CPU %",
            "max": 100
          }
        ]
      },
      {
        "datasource": "Prometheus",
        "id": 23,
        "targets": [
          {
            "expr": "rate(node_disk_read_bytes_total[5m])",
            "legendFormat": "Read - {{device}}",
            "refId": "A"
          },
          {
            "expr": "rate(node_disk_written_bytes_total[5m])",
            "legendFormat": "Write - {{device}}",
            "refId": "B"
          }
        ],
        "title": "Disk I/O",
        "type": "graph",
        "yaxes": [
          {
            "format": "Bps",
            "label": "Bytes/sec"
          }
        ]
      },
      {
        "datasource": "Prometheus",
        "id": 24,
        "targets": [
          {
            "expr": "rate(node_network_receive_bytes_total[5m])",
            "legendFormat": "RX - {{device}}",
            "refId": "A"
          },
          {
            "expr": "rate(node_network_transmit_bytes_total[5m])",
            "legendFormat": "TX - {{device}}",
            "refId": "B"
          }
        ],
        "title": "Network Traffic",
        "type": "graph",
        "yaxes": [
          {
            "format": "Bps",
            "label": "Bytes/sec"
          }
        ]
      }
    ],
    "refresh": "30s",
    "tags": [
      "database",
      "performance",
      "monitoring"
    ],
    "time": {
      "from": "now-1h",
      "to": "now"
    },
    "timezone": "UTC",
    "title": "Database Performance Monitoring",
    "version": "1.0.0"
  }
}
